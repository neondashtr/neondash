<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Neon Dash</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #game-container { position: relative; width: 100vw; height: 100vh; }
        canvas { display: block; background: #050505; }

        .panel { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 100; color: white; 
            backdrop-filter: blur(10px); animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h1 { color: #0ff; text-shadow: 0 0 20px #0ff; font-size: 5vw; margin-bottom: 10px; letter-spacing: 5px; }
        h2 { color: #0ff; font-size: 1.5vw; margin-bottom: 20px; }
        
        button { 
            background: rgba(0, 255, 255, 0.05); color: #0ff; border: 2px solid #0ff; 
            padding: 12px 30px; margin: 8px; cursor: pointer; font-size: 1.1vw; 
            transition: 0.3s; border-radius: 4px; min-width: 220px; font-weight: bold;
        }
        button:hover { background: #0ff; color: #000; box-shadow: 0 0 20px #0ff; transform: scale(1.05); }
        
        input[type="text"] {
            background: #111; border: 2px solid #0ff; color: #0ff; padding: 15px;
            font-size: 1.2vw; text-align: center; border-radius: 5px; margin-bottom: 20px; outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .ui-top { position: absolute; top: 20px; left: 20px; z-index: 10; color: #0ff; pointer-events: none; }
        #liveScore { font-size: 3vw; font-weight: bold; }
        #nickDisplay { color: #f0f; font-size: 1.2vw; margin-bottom: 5px; font-family: monospace; }

        #nick-screen, #main-menu, #diff-menu, #game-over { display: none; }
    </style>
</head>
<body>

    <audio id="gameMusic" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" type="audio/mpeg"></audio>

    <div id="game-container">
        <div class="ui-top">
            <div id="nickDisplay"></div>
            <div id="liveScore">0</div>
        </div>

        <div id="nick-screen" class="panel">
            <h1>NEON DASH</h1>
            <h2>NICKİNİ BELİRLE</h2>
            <input type="text" id="nickInput" maxlength="12" placeholder="Oyuncu Adı...">
            <button onclick="saveNick()">KAYDET VE DEVAM ET</button>
        </div>

        <div id="main-menu" class="panel">
            <h1 id="welcomeTitle">NEON DASH</h1>
            <h2 id="helloText" style="color: #f0f;"></h2>
            <button onclick="showDiff()">BAŞLAT</button>
            <button onclick="clearNick()" style="border-color: #555; color: #555; min-width: 100px; font-size: 0.8vw;">NICKİ DEĞİŞTİR</button>
        </div>

        <div id="diff-menu" class="panel">
            <h2>ZORLUK SEÇ</h2>
            <button onclick="startGame('easy')">KOLAY</button>
            <button onclick="startGame('medium')">ORTA</button>
            <button onclick="startGame('hard')">ZOR</button>
            <button onclick="showMenu()" style="border:none; text-decoration: underline;">GERİ</button>
        </div>

        <div id="game-over" class="panel">
            <h1 style="color: #ff0055;">ELENDİN</h1>
            <div id="final-score" style="font-size: 2vw; margin-bottom: 20px;">SKOR: 0</div>
            <button onclick="showDiff()">TEKRAR DENE</button>
            <button onclick="showMenu()">MENÜ</button>
        </div>

        <canvas id="gameCanvas"></canvas>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const music = document.getElementById('gameMusic');
    
    // FPS Ayarı (60 FPS Sabit)
    let lastTime = 0, targetFPS = 60, interval = 1000 / targetFPS;

    // Nick Kontrolü
    let userNick = localStorage.getItem('neon_dash_nick') || "";

    function saveNick() {
        const val = document.getElementById('nickInput').value.trim();
        if(val.length >= 2) {
            userNick = val;
            localStorage.setItem('neon_dash_nick', userNick);
            showMenu();
        } else {
            alert("Lütfen en az 2 karakter gir!");
        }
    }

    function clearNick() {
        localStorage.removeItem('neon_dash_nick');
        location.reload();
    }

    function showMenu() {
        document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
        document.getElementById('main-menu').style.display = 'flex';
        document.getElementById('helloText').innerText = "Hoş geldin, " + userNick;
        document.getElementById('nickDisplay').innerText = "PLAYER: " + userNick;
        gameActive = false;
        music.pause();
    }

    function showDiff() {
        document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
        document.getElementById('diff-menu').style.display = 'flex';
    }

    // Oyun Değişkenleri
    let gameActive = false, score = 0, frame = 0, gameSpeed = 16, currentSpeed = 16, djSpeed = 2;
    let platforms = [], obstacles = [], player = { bx: 350, by: 800, bw: 65, bh: 65, bdy: 0, bjump: -27, grounded: false, rot: 0 };

    function startGame(level) {
        if (level === 'easy') { gameSpeed = 12; djSpeed = 4; }
        else if (level === 'medium') { gameSpeed = 17; djSpeed = 2; }
        else { gameSpeed = 22; djSpeed = 1.2; }
        
        document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
        score = 0; frame = 0; obstacles = [];
        platforms = [{ x: -100, y: 920, w: 2500 }]; 
        player.by = 800; player.bdy = 0; gameActive = true;
        lastTime = performance.now();
        music.currentTime = 0; music.play().catch(()=>{});
        update(performance.now());
    }

    function update(timestamp) {
        if (!gameActive) return;
        const deltaTime = timestamp - lastTime;
        if (deltaTime >= interval) {
            lastTime = timestamp - (deltaTime % interval);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            currentSpeed = gameSpeed + (frame / 250);
            if (platforms[platforms.length-1].x + platforms[platforms.length-1].w < window.innerWidth + 1000) {
                let lastP = platforms[platforms.length - 1];
                let gap = 160 + Math.random() * 220;
                let width = 600 + Math.random() * 800;
                let newX = lastP.x + lastP.w + gap;
                platforms.push({ x: newX, y: 920, w: width });
                if(Math.random() > 0.45) obstacles.push({ x: newX + 200 + Math.random()*(width-300), y: 920, bw: 60, bh: 85 });
            }

            player.bdy += 1.6; player.by += player.bdy; player.grounded = false;

            platforms.forEach(p => {
                p.x -= currentSpeed;
                ctx.fillStyle = "#111"; ctx.strokeStyle = "#0ff"; ctx.lineWidth = 4;
                ctx.fillRect(p.x, p.y, p.w, 500);
                ctx.strokeRect(p.x, p.y, p.w, 500);
                if (player.bx + player.bw > p.x && player.bx < p.x + p.w && player.by + player.bh >= p.y && player.by + player.bh <= p.y + 40 && player.bdy >= 0) {
                    player.by = p.y - player.bh; player.bdy = 0; player.grounded = true;
                }
            });

            obstacles.forEach(s => {
                s.x -= currentSpeed;
                ctx.fillStyle = "#ff0055";
                ctx.beginPath(); ctx.moveTo(s.x, s.y); ctx.lineTo(s.x+s.bw/2, s.y-s.bh); ctx.lineTo(s.x+s.bw, s.y); ctx.fill();
                if (player.bx+15 < s.x+s.bw && player.bx+player.bw-15 > s.x && player.by+player.bh > s.y-s.bh+15 && player.by < s.y) die();
            });

            ctx.save();
            ctx.translate(player.bx+player.bw/2, player.by+player.bh/2);
            if(!player.grounded) player.rot += 0.25; else player.rot = 0;
            ctx.rotate(player.rot); ctx.fillStyle = "#0ff";
            ctx.shadowBlur = 15; ctx.shadowColor = "#0ff";
            ctx.fillRect(-player.bw/2, -player.bh/2, player.bw, player.bh);
            ctx.restore();

            if (player.by > window.innerHeight) die();
            score = Math.floor(frame / 60);
            document.getElementById('liveScore').innerText = score;
            frame++;
        }
        requestAnimationFrame(update);
    }

    function die() {
        gameActive = false;
        document.getElementById('final-score').innerText = "SKOR: " + score;
        document.getElementById('game-over').style.display = 'flex';
        music.pause();
    }

    // Kontroller
    window.onkeydown = (e) => { if (e.code === 'Space' && gameActive) { if(player.grounded) { player.bdy = player.bjump; player.grounded = false; } } };
    canvas.onmousedown = () => { if(gameActive && player.grounded) { player.bdy = player.bjump; player.grounded = false; } };

    // Başlangıç Kontrolü
    if(!userNick) {
        document.getElementById('nick-screen').style.display = 'flex';
    } else {
        showMenu();
    }
</script>
</body>
</html>
