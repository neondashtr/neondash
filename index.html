<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Neon Dash</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #game-container { position: relative; width: 100vw; height: 100vh; }
        canvas { display: block; background: #050505; }

        .panel { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 100; color: white; 
            backdrop-filter: blur(10px); animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h1 { color: #0ff; text-shadow: 0 0 20px #0ff; font-size: 5vw; margin-bottom: 10px; letter-spacing: 5px; }
        h2 { color: #0ff; font-size: 1.5vw; margin-bottom: 20px; }
        
        button { 
            background: rgba(0, 255, 255, 0.05); color: #0ff; border: 2px solid #0ff; 
            padding: 12px 30px; margin: 8px; cursor: pointer; font-size: 1.1vw; 
            transition: 0.3s; border-radius: 4px; min-width: 220px; font-weight: bold;
        }
        button:hover { background: #0ff; color: #000; box-shadow: 0 0 20px #0ff; transform: scale(1.05); }
        
        input[type="text"] {
            background: #111; border: 2px solid #0ff; color: #0ff; padding: 15px;
            font-size: 1.2vw; text-align: center; border-radius: 5px; margin-bottom: 20px; outline: none;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .ui-top { position: absolute; top: 20px; left: 20px; z-index: 10; color: #0ff; pointer-events: none; }
        #liveScore { font-size: 3vw; font-weight: bold; }
        #nickDisplay { color: #f0f; font-size: 1.2vw; margin-bottom: 5px; font-family: monospace; text-shadow: 0 0 5px #f0f; }

        #nick-screen, #main-menu, #game-over { display: none; }
    </style>
</head>
<body>

    <audio id="gameMusic" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" type="audio/mpeg"></audio>

    <div id="game-container">
        <div class="ui-top">
            <div id="nickDisplay"></div>
            <div id="liveScore">0</div>
        </div>

        <div id="nick-screen" class="panel">
            <h1>NEON DASH</h1>
            <h2>KULLANICI ADINI GİR</h2>
            <input type="text" id="nickInput" maxlength="12" placeholder="Nickiniz...">
            <button onclick="saveNick()">KAYDET VE GİRİŞ YAP</button>
        </div>

        <div id="main-menu" class="panel">
            <h1>NEON DASH</h1>
            <h2 id="helloText" style="color: #f0f;"></h2>
            <button onclick="startGame()">OYUNA BAŞLA</button>
            <button onclick="changeNick()" style="border-color: #555; color: #555; min-width: 150px; font-size: 0.8vw;">NICKİ DEĞİŞTİR</button>
        </div>

        <div id="game-over" class="panel">
            <h1 style="color: #ff0055; text-shadow: 0 0 20px #ff0055;">ELENDİN</h1>
            <div id="final-score" style="font-size: 2vw; margin-bottom: 20px;">SKOR: 0</div>
            <button onclick="startGame()">TEKRAR DENE</button>
            <button onclick="initApp()">ANA MENÜ</button>
        </div>

        <canvas id="gameCanvas"></canvas>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const music = document.getElementById('gameMusic');
    
    // FPS SABİTLEME (60 FPS)
    let lastTime = 0;
    const targetFPS = 60;
    const interval = 1000 / targetFPS;

    let userNick = localStorage.getItem('nd_user_nick') || "";

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function saveNick() {
        const val = document.getElementById('nickInput').value.trim();
        if(val.length >= 2) {
            userNick = val;
            localStorage.setItem('nd_user_nick', userNick);
            initApp();
        } else {
            alert("Nick çok kısa!");
        }
    }

    function changeNick() {
        localStorage.removeItem('nd_user_nick');
        userNick = "";
        initApp();
    }

    function initApp() {
        document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
        if(!userNick) {
            document.getElementById('nick-screen').style.display = 'flex';
        } else {
            document.getElementById('main-menu').style.display = 'flex';
            document.getElementById('helloText').innerText = "Hoş geldin, " + userNick;
            document.getElementById('nickDisplay').innerText = "OYUNCU: " + userNick;
        }
        gameActive = false;
        music.pause();
    }

    // OYUN MANTIĞI
    let gameActive = false, score = 0, frame = 0, currentSpeed = 12;
    let platforms = [], obstacles = [], player = { bx: 300, by: 0, bw: 60, bh: 60, bdy: 0, bjump: -25, grounded: false, rot: 0 };

    function startGame() {
        document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
        score = 0; frame = 0; currentSpeed = 12; obstacles = [];
        platforms = [{ x: -50, y: canvas.height * 0.8, w: 2000 }]; 
        player.by = canvas.height * 0.5; player.bdy = 0; 
        gameActive = true;
        lastTime = performance.now();
        music.currentTime = 0; music.play().catch(()=>{});
        requestAnimationFrame(gameLoop);
    }

    function gameLoop(timestamp) {
        if (!gameActive) return;
        const deltaTime = timestamp - lastTime;
        
        if (deltaTime >= interval) {
            lastTime = timestamp - (deltaTime % interval);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            currentSpeed = 12 + (frame / 300); // Zamanla hızlanma
            
            // Platform Döngüsü
            if (platforms[platforms.length-1].x + platforms[platforms.length-1].w < canvas.width + 500) {
                let lastP = platforms[platforms.length - 1];
                let gap = 150 + Math.random() * 200;
                let width = 500 + Math.random() * 800;
                platforms.push({ x: lastP.x + lastP.w + gap, y: canvas.height * 0.8, w: width });
                if(Math.random() > 0.5) obstacles.push({ x: lastP.x + lastP.w + gap + 150, y: canvas.height * 0.8, bw: 50, bh: 70 });
            }

            player.bdy += 1.5; // Yerçekimi
            player.by += player.bdy;
            player.grounded = false;

            // Platformlar
            ctx.fillStyle = "#111"; ctx.strokeStyle = "#0ff"; ctx.lineWidth = 3;
            platforms.forEach(p => {
                p.x -= currentSpeed;
                ctx.fillRect(p.x, p.y, p.w, canvas.height);
                ctx.strokeRect(p.x, p.y, p.w, canvas.height);
                
                if (player.bx + player.bw > p.x && player.bx < p.x + p.w && player.by + player.bh >= p.y && player.by + player.bh <= p.y + 40 && player.bdy >= 0) {
                    player.by = p.y - player.bh; player.bdy = 0; player.grounded = true;
                }
            });

            // Engeller
            ctx.fillStyle = "#ff0055";
            obstacles.forEach(s => {
                s.x -= currentSpeed;
                ctx.beginPath(); ctx.moveTo(s.x, s.y); ctx.lineTo(s.x+s.bw/2, s.y-s.bh); ctx.lineTo(s.x+s.bw, s.y); ctx.fill();
                if (player.bx+10 < s.x+s.bw && player.bx+player.bw-10 > s.x && player.by+player.bh > s.y-s.bh+10 && player.by < s.y) die();
            });

            // Karakter
            ctx.save();
            ctx.translate(player.bx+player.bw/2, player.by+player.bh/2);
            if(!player.grounded) player.rot += 0.2; else player.rot = 0;
            ctx.rotate(player.rot);
            ctx.fillStyle = "#0ff"; ctx.shadowBlur = 15; ctx.shadowColor = "#0ff";
            ctx.fillRect(-player.bw/2, -player.bh/2, player.bw, player.bh);
            ctx.restore();

            if (player.by > canvas.height) die();
            score = Math.floor(frame / 60);
            document.getElementById('liveScore').innerText = score;
            frame++;
        }
        requestAnimationFrame(gameLoop);
    }

    function die() {
        gameActive = false;
        document.getElementById('final-score').innerText = "SKOR: " + score;
        document.getElementById('game-over').style.display = 'flex';
        music.pause();
    }

    // Giriş Kontrolleri
    function jump() { if(gameActive && player.grounded) { player.bdy = player.bjump; player.grounded = false; } }
    window.onkeydown = (e) => { if (e.code === 'Space') jump(); };
    canvas.onmousedown = jump;

    // Uygulamayı Başlat
    initApp();
</script>
</body>
</html>
